module ivory.mailbox;

import ivory.all;

public:

import ivory.mailbox.MailboxAttacks;
import ivory.mailbox.MailboxEnprise;
import ivory.mailbox.MailboxMakeMove;
import ivory.mailbox.MailboxPosition;
import ivory.mailbox.MailboxMoveGenerator;

immutable(square)[] knightMoves(square sq) { 
    assert(sq >= 0 && sq < 64);
    auto start = sq*8;
    auto end = start + KNIGHT_MOVES_LENGTHS[sq];
    return KNIGHT_MOVES[start..end]; 
}

__gshared {
    immutable(uint)[] KNIGHT_MOVES_LENGTHS = [
        2, 3, 4, 4, 4, 4, 3, 2, 3, 4, 6, 6, 6, 6, 4, 3, 4, 6, 8, 8, 8, 8, 
        6, 4, 4, 6, 8, 8, 8, 8, 6, 4, 4, 6, 8, 8, 8, 8, 6, 4, 4, 6, 8, 8, 
        8, 8, 6, 4, 3, 4, 6, 6, 6, 6, 4, 3, 2, 3, 4, 4, 4, 4, 3, 2
    ];

    immutable(square)[] KNIGHT_MOVES = [
        10, 17, 0, 0, 0, 0, 0, 0,       // 0
        11, 16, 18, 0, 0, 0, 0, 0,      // 1
        8, 12, 17, 19, 0, 0, 0, 0,      // 2
        9, 13, 18, 20, 0, 0, 0, 0,      // 3
        10, 14, 19, 21, 0, 0, 0, 0,     // 4
        11, 15, 20, 22, 0, 0, 0, 0,     // 5
        12, 21, 23, 0, 0, 0, 0, 0,      // 6
        13, 22, 0, 0, 0, 0, 0, 0,       // 7
        2, 18, 25, 0, 0, 0, 0, 0,       // 8
        3, 19, 24, 26, 0, 0, 0, 0,      // 9
        0, 4, 16, 20, 25, 27, 0, 0,     // 10
        1, 5, 17, 21, 26, 28, 0, 0,     // 11
        2, 6, 18, 22, 27, 29, 0, 0,     // 12
        3, 7, 19, 23, 28, 30, 0, 0,     // 13
        4, 20, 29, 31, 0, 0, 0, 0,      // 14
        5, 21, 30, 0, 0, 0, 0, 0,       // 15
        1, 10, 26, 33, 0, 0, 0, 0,      // 16
        0, 2, 11, 27, 32, 34, 0, 0,     // 17
        1, 3, 8, 12, 24, 28, 33, 35,    // 18
        2, 4, 9, 13, 25, 29, 34, 36,    // 19
        3, 5, 10, 14, 26, 30, 35, 37,   // 20
        4, 6, 11, 15, 27, 31, 36, 38,   // 21
        5, 7, 12, 28, 37, 39, 0, 0,     // 22
        6, 13, 29, 38, 0, 0, 0, 0,      // 23
        9, 18, 34, 41, 0, 0, 0, 0,      // 24
        8, 10, 19, 35, 40, 42, 0, 0,    // 25
        9, 11, 16, 20, 32, 36, 41, 43,  // 26
        10, 12, 17, 21, 33, 37, 42, 44, // 27
        11, 13, 18, 22, 34, 38, 43, 45, // 28
        12, 14, 19, 23, 35, 39, 44, 46, // 29
        13, 15, 20, 36, 45, 47, 0, 0,   // 30
        14, 21, 37, 46, 0, 0, 0, 0,     // 31
        17, 26, 42, 49, 0, 0, 0, 0,     // 32
        16, 18, 27, 43, 48, 50, 0, 0,   // 33
        17, 19, 24, 28, 40, 44, 49, 51, // 34
        18, 20, 25, 29, 41, 45, 50, 52, // 35
        19, 21, 26, 30, 42, 46, 51, 53, // 36
        20, 22, 27, 31, 43, 47, 52, 54, // 37
        21, 23, 28, 44, 53, 55, 0, 0,   // 38
        22, 29, 45, 54, 0, 0, 0, 0,     // 39
        25, 34, 50, 57, 0, 0, 0, 0,     // 40
        24, 26, 35, 51, 56, 58, 0, 0,   // 41
        25, 27, 32, 36, 48, 52, 57, 59, // 42
        26, 28, 33, 37, 49, 53, 58, 60, // 43
        27, 29, 34, 38, 50, 54, 59, 61, // 44
        28, 30, 35, 39, 51, 55, 60, 62, // 45
        29, 31, 36, 52, 61, 63, 0, 0,   // 46
        30, 37, 53, 62, 0, 0, 0, 0,     // 47
        33, 42, 58, 0, 0, 0, 0, 0,      // 48
        32, 34, 43, 59, 0, 0, 0, 0,     // 49
        33, 35, 40, 44, 56, 60, 0, 0,   // 50
        34, 36, 41, 45, 57, 61, 0, 0,   // 51
        35, 37, 42, 46, 58, 62, 0, 0,   // 52
        36, 38, 43, 47, 59, 63, 0, 0,   // 53
        37, 39, 44, 60, 0, 0, 0, 0,     // 54
        38, 45, 61, 0, 0, 0, 0, 0,      // 55
        41, 50, 0, 0, 0, 0, 0, 0,       // 56
        40, 42, 51, 0, 0, 0, 0, 0,      // 57
        41, 43, 48, 52, 0, 0, 0, 0,     // 58
        42, 44, 49, 53, 0, 0, 0, 0,     // 59
        43, 45, 50, 54, 0, 0, 0, 0,     // 60
        44, 46, 51, 55, 0, 0, 0, 0,     // 61
        45, 47, 52, 0, 0, 0, 0, 0,      // 62
        46, 53, 0, 0, 0, 0, 0, 0,       // 63
    ]; 
}
