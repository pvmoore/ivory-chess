module ivory.mailbox;

import ivory.all;

public:

import ivory.mailbox.MailboxAttacks;
import ivory.mailbox.MailboxEnprise;
import ivory.mailbox.MailboxMakeMove;
import ivory.mailbox.MailboxPosition;
import ivory.mailbox.MailboxMoveGenerator;

immutable(square)[] knightMoves(square sq) { 
    assert(sq >= 0 && sq < 64);
    auto start = sq*8;
    auto end = start + KNIGHT_MOVES_LENGTHS[sq];
    return KNIGHT_MOVES[start..end]; 
}
immutable(square)[] rookMoves(square sq) { 
    assert(sq >= 0 && sq < 64);
    auto start = sq*14;
    auto end = start + 14;
    return ROOK_MOVES[start..end]; 
}

__gshared {
    immutable(uint)[] KNIGHT_MOVES_LENGTHS = [
        2, 3, 4, 4, 4, 4, 3, 2, 3, 4, 6, 6, 6, 6, 4, 3, 4, 6, 8, 8, 8, 8, 
        6, 4, 4, 6, 8, 8, 8, 8, 6, 4, 4, 6, 8, 8, 8, 8, 6, 4, 4, 6, 8, 8, 
        8, 8, 6, 4, 3, 4, 6, 6, 6, 6, 4, 3, 2, 3, 4, 4, 4, 4, 3, 2
    ];

    immutable(square)[] KNIGHT_MOVES = [
        10, 17, 0, 0, 0, 0, 0, 0,       // 0
        11, 16, 18, 0, 0, 0, 0, 0,      // 1
        8, 12, 17, 19, 0, 0, 0, 0,      // 2
        9, 13, 18, 20, 0, 0, 0, 0,      // 3
        10, 14, 19, 21, 0, 0, 0, 0,     // 4
        11, 15, 20, 22, 0, 0, 0, 0,     // 5
        12, 21, 23, 0, 0, 0, 0, 0,      // 6
        13, 22, 0, 0, 0, 0, 0, 0,       // 7
        2, 18, 25, 0, 0, 0, 0, 0,       // 8
        3, 19, 24, 26, 0, 0, 0, 0,      // 9
        0, 4, 16, 20, 25, 27, 0, 0,     // 10
        1, 5, 17, 21, 26, 28, 0, 0,     // 11
        2, 6, 18, 22, 27, 29, 0, 0,     // 12
        3, 7, 19, 23, 28, 30, 0, 0,     // 13
        4, 20, 29, 31, 0, 0, 0, 0,      // 14
        5, 21, 30, 0, 0, 0, 0, 0,       // 15
        1, 10, 26, 33, 0, 0, 0, 0,      // 16
        0, 2, 11, 27, 32, 34, 0, 0,     // 17
        1, 3, 8, 12, 24, 28, 33, 35,    // 18
        2, 4, 9, 13, 25, 29, 34, 36,    // 19
        3, 5, 10, 14, 26, 30, 35, 37,   // 20
        4, 6, 11, 15, 27, 31, 36, 38,   // 21
        5, 7, 12, 28, 37, 39, 0, 0,     // 22
        6, 13, 29, 38, 0, 0, 0, 0,      // 23
        9, 18, 34, 41, 0, 0, 0, 0,      // 24
        8, 10, 19, 35, 40, 42, 0, 0,    // 25
        9, 11, 16, 20, 32, 36, 41, 43,  // 26
        10, 12, 17, 21, 33, 37, 42, 44, // 27
        11, 13, 18, 22, 34, 38, 43, 45, // 28
        12, 14, 19, 23, 35, 39, 44, 46, // 29
        13, 15, 20, 36, 45, 47, 0, 0,   // 30
        14, 21, 37, 46, 0, 0, 0, 0,     // 31
        17, 26, 42, 49, 0, 0, 0, 0,     // 32
        16, 18, 27, 43, 48, 50, 0, 0,   // 33
        17, 19, 24, 28, 40, 44, 49, 51, // 34
        18, 20, 25, 29, 41, 45, 50, 52, // 35
        19, 21, 26, 30, 42, 46, 51, 53, // 36
        20, 22, 27, 31, 43, 47, 52, 54, // 37
        21, 23, 28, 44, 53, 55, 0, 0,   // 38
        22, 29, 45, 54, 0, 0, 0, 0,     // 39
        25, 34, 50, 57, 0, 0, 0, 0,     // 40
        24, 26, 35, 51, 56, 58, 0, 0,   // 41
        25, 27, 32, 36, 48, 52, 57, 59, // 42
        26, 28, 33, 37, 49, 53, 58, 60, // 43
        27, 29, 34, 38, 50, 54, 59, 61, // 44
        28, 30, 35, 39, 51, 55, 60, 62, // 45
        29, 31, 36, 52, 61, 63, 0, 0,   // 46
        30, 37, 53, 62, 0, 0, 0, 0,     // 47
        33, 42, 58, 0, 0, 0, 0, 0,      // 48
        32, 34, 43, 59, 0, 0, 0, 0,     // 49
        33, 35, 40, 44, 56, 60, 0, 0,   // 50
        34, 36, 41, 45, 57, 61, 0, 0,   // 51
        35, 37, 42, 46, 58, 62, 0, 0,   // 52
        36, 38, 43, 47, 59, 63, 0, 0,   // 53
        37, 39, 44, 60, 0, 0, 0, 0,     // 54
        38, 45, 61, 0, 0, 0, 0, 0,      // 55
        41, 50, 0, 0, 0, 0, 0, 0,       // 56
        40, 42, 51, 0, 0, 0, 0, 0,      // 57
        41, 43, 48, 52, 0, 0, 0, 0,     // 58
        42, 44, 49, 53, 0, 0, 0, 0,     // 59
        43, 45, 50, 54, 0, 0, 0, 0,     // 60
        44, 46, 51, 55, 0, 0, 0, 0,     // 61
        45, 47, 52, 0, 0, 0, 0, 0,      // 62
        46, 53, 0, 0, 0, 0, 0, 0,       // 63
    ]; 
    immutable(square)[] ROOK_MOVES = [
        1, 2, 3, 4, 5, 6, 7, 8, 16, 24, 32, 40, 48, 56,         // 0
        0, 2, 3, 4, 5, 6, 7, 9, 17, 25, 33, 41, 49, 57,         // 1
        0, 1, 3, 4, 5, 6, 7, 10, 18, 26, 34, 42, 50, 58,        // 2
        0, 1, 2, 4, 5, 6, 7, 11, 19, 27, 35, 43, 51, 59,        // 3
        0, 1, 2, 3, 5, 6, 7, 12, 20, 28, 36, 44, 52, 60,        // 4
        0, 1, 2, 3, 4, 6, 7, 13, 21, 29, 37, 45, 53, 61,        // 5
        0, 1, 2, 3, 4, 5, 7, 14, 22, 30, 38, 46, 54, 62,        // 6
        0, 1, 2, 3, 4, 5, 6, 15, 23, 31, 39, 47, 55, 63,        // 7
        0, 9, 10, 11, 12, 13, 14, 15, 16, 24, 32, 40, 48, 56,   // 8
        1, 8, 10, 11, 12, 13, 14, 15, 17, 25, 33, 41, 49, 57,   // 9
        2, 8, 9, 11, 12, 13, 14, 15, 18, 26, 34, 42, 50, 58,    // 10
        3, 8, 9, 10, 12, 13, 14, 15, 19, 27, 35, 43, 51, 59,    // 11
        4, 8, 9, 10, 11, 13, 14, 15, 20, 28, 36, 44, 52, 60,    // 12
        5, 8, 9, 10, 11, 12, 14, 15, 21, 29, 37, 45, 53, 61,    // 13
        6, 8, 9, 10, 11, 12, 13, 15, 22, 30, 38, 46, 54, 62,    // 14
        7, 8, 9, 10, 11, 12, 13, 14, 23, 31, 39, 47, 55, 63,    // 15
        0, 8, 17, 18, 19, 20, 21, 22, 23, 24, 32, 40, 48, 56,   // 16
        1, 9, 16, 18, 19, 20, 21, 22, 23, 25, 33, 41, 49, 57,   // 17
        2, 10, 16, 17, 19, 20, 21, 22, 23, 26, 34, 42, 50, 58,  // 18
        3, 11, 16, 17, 18, 20, 21, 22, 23, 27, 35, 43, 51, 59,  // 19
        4, 12, 16, 17, 18, 19, 21, 22, 23, 28, 36, 44, 52, 60,  // 20
        5, 13, 16, 17, 18, 19, 20, 22, 23, 29, 37, 45, 53, 61,  // 21
        6, 14, 16, 17, 18, 19, 20, 21, 23, 30, 38, 46, 54, 62,  // 22
        7, 15, 16, 17, 18, 19, 20, 21, 22, 31, 39, 47, 55, 63,  // 23
        0, 8, 16, 25, 26, 27, 28, 29, 30, 31, 32, 40, 48, 56,   // 24
        1, 9, 17, 24, 26, 27, 28, 29, 30, 31, 33, 41, 49, 57,   // 25
        2, 10, 18, 24, 25, 27, 28, 29, 30, 31, 34, 42, 50, 58,  // 26
        3, 11, 19, 24, 25, 26, 28, 29, 30, 31, 35, 43, 51, 59,  // 27
        4, 12, 20, 24, 25, 26, 27, 29, 30, 31, 36, 44, 52, 60,  // 28
        5, 13, 21, 24, 25, 26, 27, 28, 30, 31, 37, 45, 53, 61,  // 29
        6, 14, 22, 24, 25, 26, 27, 28, 29, 31, 38, 46, 54, 62,  // 30
        7, 15, 23, 24, 25, 26, 27, 28, 29, 30, 39, 47, 55, 63,  // 31
        0, 8, 16, 24, 33, 34, 35, 36, 37, 38, 39, 40, 48, 56,   // 32
        1, 9, 17, 25, 32, 34, 35, 36, 37, 38, 39, 41, 49, 57,   // 33
        2, 10, 18, 26, 32, 33, 35, 36, 37, 38, 39, 42, 50, 58,  // 34
        3, 11, 19, 27, 32, 33, 34, 36, 37, 38, 39, 43, 51, 59,  // 35
        4, 12, 20, 28, 32, 33, 34, 35, 37, 38, 39, 44, 52, 60,  // 36
        5, 13, 21, 29, 32, 33, 34, 35, 36, 38, 39, 45, 53, 61,  // 37
        6, 14, 22, 30, 32, 33, 34, 35, 36, 37, 39, 46, 54, 62,  // 38
        7, 15, 23, 31, 32, 33, 34, 35, 36, 37, 38, 47, 55, 63,  // 39
        0, 8, 16, 24, 32, 41, 42, 43, 44, 45, 46, 47, 48, 56,   // 40
        1, 9, 17, 25, 33, 40, 42, 43, 44, 45, 46, 47, 49, 57,   // 41
        2, 10, 18, 26, 34, 40, 41, 43, 44, 45, 46, 47, 50, 58,  // 42
        3, 11, 19, 27, 35, 40, 41, 42, 44, 45, 46, 47, 51, 59,  // 43
        4, 12, 20, 28, 36, 40, 41, 42, 43, 45, 46, 47, 52, 60,  // 44
        5, 13, 21, 29, 37, 40, 41, 42, 43, 44, 46, 47, 53, 61,  // 45
        6, 14, 22, 30, 38, 40, 41, 42, 43, 44, 45, 47, 54, 62,  // 46
        7, 15, 23, 31, 39, 40, 41, 42, 43, 44, 45, 46, 55, 63,  // 47
        0, 8, 16, 24, 32, 40, 49, 50, 51, 52, 53, 54, 55, 56,   // 48
        1, 9, 17, 25, 33, 41, 48, 50, 51, 52, 53, 54, 55, 57,   // 49
        2, 10, 18, 26, 34, 42, 48, 49, 51, 52, 53, 54, 55, 58,  // 50
        3, 11, 19, 27, 35, 43, 48, 49, 50, 52, 53, 54, 55, 59,  // 51
        4, 12, 20, 28, 36, 44, 48, 49, 50, 51, 53, 54, 55, 60,  // 52
        5, 13, 21, 29, 37, 45, 48, 49, 50, 51, 52, 54, 55, 61,  // 53
        6, 14, 22, 30, 38, 46, 48, 49, 50, 51, 52, 53, 55, 62,  // 54
        7, 15, 23, 31, 39, 47, 48, 49, 50, 51, 52, 53, 54, 63,  // 55
        0, 8, 16, 24, 32, 40, 48, 57, 58, 59, 60, 61, 62, 63,   // 56
        1, 9, 17, 25, 33, 41, 49, 56, 58, 59, 60, 61, 62, 63,   // 57
        2, 10, 18, 26, 34, 42, 50, 56, 57, 59, 60, 61, 62, 63,  // 58
        3, 11, 19, 27, 35, 43, 51, 56, 57, 58, 60, 61, 62, 63,  // 59
        4, 12, 20, 28, 36, 44, 52, 56, 57, 58, 59, 61, 62, 63,  // 60
        5, 13, 21, 29, 37, 45, 53, 56, 57, 58, 59, 60, 62, 63,  // 61
        6, 14, 22, 30, 38, 46, 54, 56, 57, 58, 59, 60, 61, 63,  // 62
        7, 15, 23, 31, 39, 47, 55, 56, 57, 58, 59, 60, 61, 62,  // 63
    ];

}
